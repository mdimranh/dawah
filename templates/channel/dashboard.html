{% extends 'base.html' %}
{% load humanize %}
{% load static %}
{% comment %} {% load custom_tags %} {% endcomment %}
{% block extra_link %}
<link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.min.css' %}" />
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
{% endblock %} {% block dashboard %}

<div class="d-flex align-items-start dashboard-content">
  <div class="nav dashboard-sidenav flex-column me-3 pt-3 no-wrap" id="v-pills-tab" role="tablist" aria-orientation="vertical">
    <a href="{% url 'home' %}" ><img class="logo dashboard-sidenav-logo" src="{% static 'img/logo1.png' %}" alt=""/></a>
    <div
      class="p active m-0 py-2 d-flex align-items-center h5"
      id="v-pills-dashboard-tab"
      data-bs-toggle="pill"
      data-bs-target="#v-pills-dashboard"
      type="button"
      role="tab"
      aria-controls="v-pills-dashboard"
      aria-selected="true"
    >
      <i class="fa fa-area-chart me-2"></i>
      <p class="m-0">Dashboard</p>
    </div>
    <div
      class="p m-0 py-2 d-flex align-items-center h5"
      id="v-pills-videos-tab"
      data-bs-toggle="pill"
      data-bs-target="#v-pills-videos"
      type="button"
      role="tab"
      aria-controls="v-pills-videos"
      aria-selected="false"
    >
      <i class="fa fa-film me-2"></i>
      <p class="m-0">Videos</p>
    </div>
    <div
      class="p m-0 py-2 d-flex align-items-center h5"
      id="v-pills-folders-tab"
      data-bs-toggle="pill"
      data-bs-target="#v-pills-folders"
      type="button"
      role="tab"
      aria-controls="v-pills-folders"
      aria-selected="false"
    >
      <i class="fa fa-folder-open me-2"></i>
      <p class="m-0">Folders</p>
    </div>
    <div
      class="p m-0 py-2 d-flex align-items-center h5"
      id="v-pills-qa-tab"
      data-bs-toggle="pill"
      data-bs-target="#v-pills-qa"
      type="button"
      role="tab"
      aria-controls="v-pills-qa"
      aria-selected="false"
    >
      <i class="fa fa-comments me-2"></i>
      <p class="m-0">Q/A</p>
    </div>
    <div
      class="p m-0 py-2 d-flex align-items-center h5"
      id="v-pills-comments-tab"
      data-bs-toggle="pill"
      data-bs-target="#v-pills-comments"
      type="button"
      role="tab"
      aria-controls="v-pills-comments"
      aria-selected="false"
    >
      <i class="zmdi zmdi-comment-text-alt me-2 mt-1"></i>
      <p class="m-0">Comments</p>
    </div>
  </div>
  <div
    class="tab-content flex-fill"
    id="v-pills-tabContent">
    <!-- .......... Dashboard section............... -->

    <div
      class="tab-pane fade show active"
      id="v-pills-dashboard"
      role="tabpanel"
      aria-labelledby="v-pills-videos-tab"
    >
      <div class="container-fluid dashboard-section">
        <div class="row">
          <div class="col-lg-3 col-6 mb-3">
            <div
              class="
                number
                video
                d-flex
                align-items-center
                justify-content-between
              "
            >
              <div class="d-flex flex-column ps-2">
                <p class="m-0 px-0 pt-1 pb-3 h4">videos</p>
                <p class="m-0 p-0 h4">{{totalvideo}}</p>
              </div>
              <i class="fa-icon fa fa-film pe-2 ps-5"></i>
            </div>
          </div>
          <div class="col-lg-3 col-6">
            <div
              class="
                number
                follower
                d-flex
                align-items-center
                justify-content-between
              "
            >
              <div class="d-flex flex-column ps-2">
                <p class="m-0 px-0 pt-1 pb-3 h4">Followers</p>
                <p class="m-0 p-0 h4">{{follower}}</p>
              </div>
              <i class="fa-icon fa fa-star pe-2 ps-5"></i>
            </div>
          </div>
          <div class="col-lg-3 col-6">
            <div
              class="
                number
                folder
                d-flex
                align-items-center
                justify-content-between
              "
            >
              <div class="d-flex flex-column ps-2">
                <p class="m-0 px-0 pt-1 pb-3 h4">Folders</p>
                <p class="m-0 p-0 h4">{{folder}}</p>
              </div>
              <i class="fa-icon fa fa-folder-open pe-2 ps-5"></i>
            </div>
          </div>
          <div class="col-lg-3 col-6">
            <div
              class="
                number
                questionanswer
                d-flex
                align-items-center
                justify-content-between
              "
            >
              <div class="d-flex flex-column ps-2">
                <p class="m-0 px-0 pt-1 pb-3 h4">Q/A</p>
                <p class="m-0 p-0 h5">15</p>
              </div>
              <i class="fa-icon fa fa-comments pe-2 ps-5"></i>
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-lg-6 col">
            <div class="d-flex flex-column">
              <div class="analysis-title d-flex justify-content-between">
                <p class="h5 py-2 m-0 px-3" id="duration">Last week</p>
                <select
                  class="form-select analyze-select form-select-sm m-2"
                  aria-label=".form-select-sm example"
                  id="select"
                  onchange="changeDuration(event);"
                >
                  <option value="7" id="option" selected>Last week</option>
                  <option value="30" id="option">Last month</option>
                  <option value="365" id="option">Last year</option>
                </select>
              </div>
              <div class="d-flex flex-column px-3 pt-2 pb-3 chart-div">
                <div class="d-flex">
                  <p
                    class="h6 py-2 m-0 me-3 totalview"
                    id="duration-total-view"
                  >
                    total views : {{totalview}}
                  </p>
                  <p class="h6 py-2 m-0 totallike" id="duration-total-like">
                    total likes : {{totallike}}
                  </p>
                </div>
                <div id="chart">
                  <canvas class="chart" id="pie-chart1"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6 col mt-lg-0 mt-3">
            <div class="d-flex flex-column">
              <div class="analysis-title d-flex justify-content-between">
                <p class="h5 py-2 m-0 px-3">Today</p>
                <select
                  class="form-select analyze-select form-select-sm m-2"
                  aria-label=".form-select-sm example"
                  id="select1"
                  onchange="changeChart()"
                >
                  <option value="bar" id="option" selected>Bar Chart</option>
                  <option value="line" id="option">Area Chart</option>
                  <option value="pie" id="option">Pie Chart</option>
                  <option value="polarArea" id="option">PolarArea Chart</option>
                </select>
              </div>
              <div class="d-flex flex-column px-3 pt-2 pb-3 chart-div">
                <div class="d-flex">
                  <p class="h6 py-2 m-0 me-3 totalview" id="today-total-view">
                    total views : {{totalview}}
                  </p>
                  <p class="h6 py-2 m-0 totallike" id="today-total-like">
                    total likes : {{totallike}}
                  </p>
                </div>
                <div id="chart">
                  <canvas class="chart" id="pie-chart2"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="top-video mt-4">
            <div class="analysis-title d-flex justify-content-between">
                <p class="h5 py-2 m-0 px-3">Your top video</p>
                <select
                  class="form-select analyze-select form-select-sm m-2"
                  aria-label=".form-select-sm example"
                  id="select1"
                >
                  <option value="2" id="option" selected>Top 2</option>
                  <option value="5" id="option">Top 5</option>
                  <option value="10" id="option">Top 10</option>
                </select>
              </div>
            <div class="table-div">
            <table class="table table-hover table-secondary" style="border: 1px solid lightgray;">
              <thead class="table-info">
                <th scope="col">Videos</th>
                <th scope="col">Titles</th>
                <th scope="col">Views</th>
                <th scope="col">Likes</th>
                <th scope="col">Unlikes</th>
                <th scope="col">Comments</th>
              </thead>
              <tbody>
                {% for video, a in topvideo %}
                  <tr style="height: 61px;" class="w-50">
                    <td><img class="thumbnail" src="{{video.thumbnail}}" /></td>
                    <td class="d-flex h-100 flex-column align-items-start">
                      <div class="d-flex align-items-center justify-content-start">
                        <div class="action d-flex justify-content-start align-items-center">
                          <a href="/play_C={{video.channel.namews}}_V={{video.id2}}"><i class="fa fa-play-circle fa-lg me-2"></i></a>
                          <a href="/edit_C={{video.channel.namews}}_V={{video.id2}}"><i class="fa fa-pencil-square fa-lg mx-2"></i></a>
                          {% comment %} <i class="fa fa-share-square fa-lg mx-2"></i> {% endcomment %}
                          <i class="fa fa-trash fa-lg mx-2"></i>
                        </div>
                        <div class="video-title" >{{video.title}}</div>
                      </div>
                    </td>
                    <td><div class="mt-3">{{video.total_views}}</div></td>
                    <td><div class="mt-3">{{video.total_likes}}</div></td>
                    <td><div class="mt-3">{{video.total_unlikes}}</div></td>
                    <td><div class="mt-3">{{comment}}</div></td>
                  </tr>
                  {% endfor %}
              </tbody>
            </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- .......... All videos section............... -->

    <div
      class="tab-pane fade"
      id="v-pills-videos"
      role="tabpanel"
      aria-labelledby="v-pills-videos-tab"
    >
      <div>
        {% if video %}
        <div class="d-flex justify-content-end me-2 mb-4 mt-2 sticky-top">
          <i
            class="fa fa-list-ul fa-lg ms-3"
            id="videolist"
            style="cursor: pointer"
          ></i>
          <i
            class="fa fa-th fa-lg ms-3"
            id="videogrid"
            style="color: #a6a6a6; cursor: pointer"
          ></i>
        </div>
        {% endif %}
      </div>
      <div>
        <div class="container-fluid" id="video-grid-view" style="display: none">
          <div class="row row-cols-auto justify-content-center">
            {% for video in video %}
            <div class="col pb-4">
              <div class="card shadow-sm">
                <li class="dropdown card-img">
                  <img src="{{video.thumbnail}}" class="card-img-top" />
                  <a href="/{{video.channel.channel_name}}/{{video.id}}">
                    <img
                      class="card-img-hover"
                      src="{% static 'img/card-img-hover.jpg' %}"
                    />
                  </a>
                  <i class="fa fa-exclamation-circle fa-lg video-info-btn"></i>
                </li>
                <div class="d-flex justify-content-between mx-2">
                  <mark class="py-0 px-1 time">3:52</mark>
                  <div class="d-flex time px-1">
                    <p class="m-0">3 days ago</p>
                    <p class="m-0 px-2">|</p>
                    <p class="m-0">1M Views</p>
                  </div>
                </div>
                <div class="card-body p-1">
                  <p class="card-title px-2 m-0">{{video.title}}</p>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        <div class="table-div">
            <div class="video-table">
            {% comment %} <div class="d-flex flex-fill align-items-center bg-white extra-div">
              <p class="p-0 m-0 select-count"></p>
              <button class="btn btn-danger btn-sm ms-3 my-1">Delete</button>
            </div> {% endcomment %}
            <table id="allvideo" class="table table-hover table-light" style="border: 1px solid lightgray;">
              <input class="form-control sticky-left sticky-top search-input" type="text" id="myInput" onkeyup="myFunction()" placeholder="Search video title here..">
              <thead class="table-success sticky-top" style="top: 37px;">
                <th class="col1 small"><input class="form-check-input select-all video-check" type="checkbox" value="all" id="flexCheckDefault"></th>
                <th class="col2 small" scope="col">Videos</th>
                <th class="col3 small" scope="col">Titles</th>
                <th class="small" scope="col">Date</th>
                <th class="small" scope="col">Visibility</th>
                <th class="small" scope="col">Views</th>
                <th class="small" scope="col">Comments</th>
                <th class="small text-nowrap" scope="col">Like Vs Dislike</th>
              </thead>
              <tbody>
                {% for video in video %}
                  <tr style="height: 61px;" class="w-50">
                    <td class="col1"><input class="form-check-input mt-3 video-check" type="checkbox" value="{{video.id2}}" id="flexCheckDefault"></td>
                    <td class="col2"><img class="thumbnail" src="{{video.thumbnail}}" /></td>
                    <td class="d-flex flex-column align-items-start col3">
                      <div class="d-flex align-items-center justify-content-start">
                        <div class="action d-flex justify-content-start align-items-center">
                          <a href="/play_C={{video.channel.namews}}_V={{video.id2}}"><i class="fa fa-play-circle fa-lg me-2"></i></a>
                          <a href="/edit_C={{video.channel.namews}}_V={{video.id2}}"><i class="fa fa-pencil-square fa-lg mx-2"></i></a>
                          {% comment %} <i class="fa fa-share-square fa-lg mx-2"></i> {% endcomment %}
                          <i class="fa fa-trash fa-lg mx-2" data-bs-toggle="modal" data-bs-target="#deleteConfirm" onclick='confirmDelete("{{video.id2}}", "{{video.title}}", "{{video.datetime}}", "{{video.thumbnail}}", "{{video.total_views}}", "{{forloop.counter}}")'></i>
                        </div>
                        <div class="video-title" >{{video.title}}</div>
                      </div>
                    </td>
                    <td><div class="mt-3 date">{{video.date}}</div></td>
                    <td><div class="mt-3">{{video.visibility}}</div></td>
                    <td><div class="mt-3">{{video.total_views}}</div></td>
                    <td><div class="mt-3">{{video.total_comments}}</div></td>
                    {% comment %} <td><div class="mt-3">{{video.total_likes|percentage:video.total_unlikes}}</div></td> {% endcomment %}
                  </tr>
                  {% endfor %}
              </tbody>
            </table>
            </div>
        </div>
      </div>
    </div>

    <!-- .......... All Folder section............... -->

    <div
      class="tab-pane fade"
      id="v-pills-folders"
      role="tabpanel"
      aria-labelledby="v-pills-folders-tab"
    >
      <div>
        {% if folders %}
        <div class="d-flex justify-content-end me-2 mb-4 mt-2">
          <i
            class="fa fa-list-ul fa-lg ms-3"
            id="folderlist"
            style="color: #a6a6a6; cursor: pointer"
          ></i>
          <i
            class="fa fa-th fa-lg ms-3"
            id="foldergrid"
            style="cursor: pointer"
          ></i>
        </div>
        {% endif %}
      </div>
      <div class="container-fluid" id="folder-grid-view">
        <div class="row row-cols-auto justify-content-center">
          {% for folder in folders %}
          <div class="col pb-4">
            <div class="card shadow-sm">
              <li class="dropdown card-img">
                <img src="{{folder.thumbnail}}" class="card-img-top" />
                <img
                  class="card-img-hover"
                  src="{% static 'img/card-img-hover.jpg' %}"
                />
                <i class="fa fa-folder fa-3x folder-info-btn"></i>
                <i class="fa fa-pencil fa-lg folder-edit-btn"></i>
              </li>
              <div class="d-flex justify-content-between mx-2">
                <div class="d-flex folder-time px-1">
                  <p class="m-0">{{folder.no_video}}</p>
                </div>
              </div>
              <div class="card-body p-1">
                <h5
                  class="
                    card-title
                    text-center
                    m-0
                    d-flex
                    flex-column
                    justify-content-center
                  "
                >
                  {{folder.name}}
                </h5>
              </div>
            </div>
          </div>
          {% endfor %} {% for folder in folders %} {%empty%}
          <div class="d-flex flex-column align-items-center mt-5">
            <i class="icofont icofont-emo-crying crying"></i>
            <p class="h5">Dont have any folder.</p>
          </div>
          {% endfor %}
        </div>
      </div>
      <div class="table-div">
      <table
        class="table table-light table-hover"
        id="folder-list-view"
        style="display: none"
      >
        <thead>
          <tr>
            <th scope="col">Thumbnail</th>
            <th scope="col">Name</th>
            <th scope="col">Videos</th>
            <th scope="col">Visbility</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for folder in folders %}
          <tr>
            <td><img class="thumbnail" src="{{folder.thumbnail}}" alt="" /></td>
            <td>{{folder.name}}</td>
            <td>{{folder.no_video}}</td>
            <td>Public</td>
            <td>
              <div class="d-flex">
                <i class="fa fa-pencil-square fa-lg mx-1" data-bs-toggle="modal" data-bs-target="#editFolder" onclick='editFolder("{{folder.id}}", "{{folder.thumbnail}}", "{{folder.name}}", "{{folder.no_video}}")'></i>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    </div>

    <!-- .......... All Comments section............... -->

    <div
      class="tab-pane fade"
      id="v-pills-comments"
      role="tabpanel"
      aria-labelledby="v-pills-comments-tab"
    >
    {% for number in number %}
      <p>{{number|intcomma}}</p>
    {% endfor %}
    </div>

    <!-- .......... All Question/Answer section............... -->

    <div
      class="tab-pane fade"
      id="v-pills-qa"
      role="tabpanel"
      aria-labelledby="v-pills-qa-tab"
    >
      Q/A
    </div>
  </div>
</div>




<!-- .......... Delete confirmation modal ............... -->
<div class="modal fade" id="deleteConfirm" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="deleteConfirmLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body d-flex flex-column">
        <form class="d-flex flex-column" method="post" onsubmit="onDeleteVideo(event)">
          <p class="pb-4 pt-0 m-0 h5">Confirm to delete</p>
          <div class="d-flex">
            <img src="" class="modal-thumbnail">
            <div class="d-flex flex-column">
              <p class="ms-2 p-0 title modal-video-title"></p>
              <p class="ms-2 p-0 text-muted modal-datetime"></p>
              <p class="ms-2 p-0 text-muted modal-views"></p>
              <p class="id2 d-none"></p>
              <p class="row-number d-none"></p>
            </div>
          </div>
          <div class="form-group form-check my-3">
            <input type="checkbox" class="form-check-input" id="delete-checkbox">
            <label class="form-check-label" id="confirm-check" for="delete-checkbox">Sure, I'll delete this video</label>
          </div>
          <div class="d-flex justify-content-end mt-3">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" id="delete-btn" class="btn btn-success btn-sm mx-2" disabled>Delete</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- .......... Folder edit modal ............... -->
<div class="modal fade" id="editFolder" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="editFolderLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body d-flex flex-column">
        <form class="d-flex flex-column" method="post">
          <p class="pb-4 pt-0 m-0 h5">Edit folder</p>
          <div class="d-flex">
            <label for="folderthumbnail"><img src="" id="folder-modal-thumbnail" class="folder-modal-thumbnail modal-thumbnail"></label>
            <input
              class="form-control d-none"
              placeholder="choose thumbnail"
              type="file"
              id="folderthumbnail"
              name="folderthumbnail"
              onchange="loadThumbnail(event)"
            />
            <div class="d-flex flex-column">
              <div class="d-flex mb-2 align-items-center">
                <p class="mx-2 my-0 p-0 h6 fw-bold">Name:</p>
                <input class="form-control px-2 py-0 m-0" type="text" name="folder-title" id="take-folder-title" style="display: none;">
                <p class="m-0 p-0 h6 modal-folder-title"></p>
              </div>
              <div class="d-flex mb-2 align-items-center">
                <p class="mx-2 my-0 p-0 h6 fw-bold">Visibility:</p>
                <select class="form-select py-0" aria-label="Default select example">
                  <option selected value="public">Public</option>
                  <option value="private">Private</option>
                </select>
              </div>
              <p class="folder-id d-none"></p>
              {% comment %} <p class="ms-2 p-0 text-muted modal-folder-datetime"></p> {% endcomment %}
              <p class="ms-2 p-0 h5 text-muted modal-folder-videos"></p>
            </div>
          </div>
          <div class="form-group form-check my-3">
            <input type="checkbox" class="form-check-input" id="edit-checkbox">
            <label class="form-check-label" id="edit-check" for="edit-checkbox">Sure, I'll delete this folder</label>
          </div>
          <div class="d-flex justify-content-end mt-3">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-success btn-sm ms-2" data-bs-dismiss="modal">Update</button>
            <button type="submit" id="delete-btn" class="btn btn-danger btn-sm mx-2" disabled>Delete</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<div class="alert bg-success align-items-center alert-bottom" role="alert" style="display: none;">
  <div class="text-white">Video delete successfull</div>
</div>




<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/bootstrap-datepicker.min.js' %}"></script>
<script src="{% static 'js/chart/chart.min.js' %}"></script>
<script src="{% static 'js/chart/core.js' %}"></script>
<script src="{% static 'js/chart/charts.js' %}"></script>
<script src="{% static 'js/chart/animated.js' %}"></script>
{% comment %} <script>
  $(document).ready(function () {
    setInterval(function () {
      let intViewportHeight = window.innerHeight - 89;
      let intViewportHeight1 = window.innerHeight - 0;
      document.getElementById("v-pills-tab").style["height"] =
        "" + intViewportHeight1 + "px";
      document.getElementById("v-pills-tabContent").style["height"] =
        "" + intViewportHeight + "px";
    });
  });
</script> {% endcomment %}


<script>
var loadThumbnail = function(event) {
	var image = document.getElementById('folder-modal-thumbnail');
	image.src = URL.createObjectURL(event.target.files[0]);
};
</script>

<script>
  $( ".modal-folder-title" ).click(function() {
    $('.modal-folder-title').css({'display':'none'});
    $('#take-folder-title').css({'display':'block'});
    $('#take-folder-title').focus();
  });
</script>

<!-- <script>
  const navigate = document.querySelector(".dashboard-content");
  document.querySelector(".toggle").onclick = function () {
    this.classList.toggle("active");
    navigate.classList.toggle("active");
  };
</script> -->

<script>
  var ctx = document.getElementById("pie-chart1").getContext("2d");
  var myChart1 = new Chart(ctx, {
    type: "line",
    data: {
      labels: {{day_name|safe}},
      datasets: [
        {
          fill: {
            target: 'origin',
            above: 'rgba(255, 0, 0, 0.2)',
            below: 'rgba(0, 0, 255, 0.2)'
          },
          label: "view",
          data: {{no_view|safe}},
          backgroundColor: [
            "rgba(255, 99, 132, 0.5)",
            "rgba(54, 162, 235, 0.5)",
            "rgba(255, 206, 86, 0.8)",
            "rgba(75, 192, 192, 0.5)",
            "rgba(153, 102, 255, 0.5)",
            "rgba(255, 159, 64, 0.5)",
            "rgba(190, 214, 98, 0.5)",
          ],
          borderColor: [
            "rgba(255, 99, 132, 1)",
            "rgba(54, 162, 235, 1)",
            "rgba(255, 206, 86, 1)",
            "rgba(75, 192, 192, 1)",
            "rgba(153, 102, 255, 1)",
            "rgba(255, 159, 64, 1)",
            "rgba(190, 214, 98, 1)",
          ],
          borderWidth: 2,
        },
        {
          fill: {
            target: 'origin',
            above: 'rgba(145, 201, 253, 0.5)',
            below: 'rgba(145, 201, 253, 0.5)'
          },
          label: "like",
          data: {{no_like|safe}},
          backgroundColor: [
            "rgba(255, 99, 132, 0.5)",
            "rgba(54, 162, 235, 0.5)",
            "rgba(255, 206, 86, 0.8)",
            "rgba(75, 192, 192, 0.5)",
            "rgba(153, 102, 255, 0.5)",
            "rgba(255, 159, 64, 0.5)",
            "rgba(190, 214, 98, 0.5)",
          ],
          borderColor: [
            "rgba(255, 99, 132, 1)",
            "rgba(54, 162, 235, 1)",
            "rgba(255, 206, 86, 1)",
            "rgba(75, 192, 192, 1)",
            "rgba(153, 102, 255, 1)",
            "rgba(255, 159, 64, 1)",
            "rgba(190, 214, 98, 1)",
          ],
          borderWidth: 2,
        },
      ],
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });
  function dataupdate(no_view, no_like, labels){
    myChart1.data.labels = labels;
    myChart1.data.datasets[0].data = no_view;
    myChart1.data.datasets[1].data = no_like;
    myChart1.update();
  }
</script>

<script>
  myData= {
      labels: ["views", "likes", "comments", "follows"],
      datasets: [
        {
          fill: {
            target: 'origin',
            above: 'rgba(0, 81, 12, 0.2)',
            below: 'rgba(0, 81, 12, 0.2)'
          },
          label: "In todays",
          data: {{todaydata|safe}},
          backgroundColor: [
            "rgba(54, 162, 235, 0.5)",
            "rgba(255, 99, 132, 0.5)",
            "rgba(67, 82, 112, 0.8)",
            "rgba(85, 126, 122, 0.8)"
          ],
          borderColor: [
            "rgba(54, 162, 235, 1)",
            "rgba(255, 99, 132, 1)",
            "rgba(67, 82, 112, 1)",
            "rgba(85, 126, 122, 1)"
          ],
          borderWidth: 2,
        },
      ],
      
    };

    var ctx = document.getElementById("pie-chart2").getContext("2d");
    var myChart2 = new Chart(ctx, {
      type: 'bar',
      data: myData,
      options: {
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      }
    });

    function changeChart(){
      var selectBox = document.getElementById("select1");
      var tp = selectBox.options[selectBox.selectedIndex].value;
      myChart2.destroy();
      myChart2 = new Chart(ctx, {
        type: tp,
        data: myData,
        options: {
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      }
      });
    };
</script>

<script>
  {% for channel in channel %}
  function getdata() {
    $(function(){
        $.ajax({
          type:'GET',
          url: "/{{channel.namews}}_{{channel.id2}}/getdata",
          success: function(response){
            no_view = response.no_view;
            no_like = response.no_like;
            labels = response.day_name;
            dataupdate(no_view, no_like, labels);
            if (response.duration === "7"){
              document.getElementById("duration").innerHTML = "Last week";
            }
            else if (response.duration === "30"){
              document.getElementById("duration").innerHTML = "Last month";
            }
            else {
              document.getElementById("duration").innerHTML = "Last year";
            }
            document.getElementById("duration-total-view").innerHTML = "total views : "+response.totalview;
            document.getElementById("duration-total-like").innerHTML = "total likes : "+response.totallike;
          },
        });
    });
  }
  {% endfor %}
</script>

<script>
  function changeDuration(event){
    event.preventDefault();

    var selectBox = document.getElementById("select");
    var selectValue = selectBox.options[selectBox.selectedIndex].value;
    var formData = new FormData();
    formData.append("duration", selectValue);

    var xhr=new XMLHttpRequest();
    {% for channel in channel %}
    xhr.open("POST", "http://localhost:8000/{{channel.namews}}_{{channel.id2}}/dashboard", true);
    {% endfor %}
    xhr.send(formData);
    xhr.addEventListener('load', (event) =>{
      getdata();
    });
  }
</script>

<script>
  document.getElementById("videogrid").onclick = function () {
    document.getElementById("video-list-view").style["display"] = "none";
    document.getElementById("video-grid-view").style["display"] = "block";
    document.getElementById("videolist").style["color"] = "#A6A6A6";
    document.getElementById("videogrid").style["color"] = "#00510C";
  };
  document.getElementById("videolist").onclick = function () {
    document.getElementById("video-list-view").style["display"] = "";
    document.getElementById("video-grid-view").style["display"] = "none";
    document.getElementById("videolist").style["color"] = "#00510C";
    document.getElementById("videogrid").style["color"] = "#A6A6A6";
  };

  document.getElementById("foldergrid").onclick = function () {
    document.getElementById("folder-list-view").style["display"] = "none";
    document.getElementById("folder-grid-view").style["display"] = "block";
    document.getElementById("folderlist").style["color"] = "#A6A6A6";
    document.getElementById("foldergrid").style["color"] = "#00510C";
  };
  document.getElementById("folderlist").onclick = function () {
    document.getElementById("folder-list-view").style["display"] = "";
    document.getElementById("folder-grid-view").style["display"] = "none";
    document.getElementById("folderlist").style["color"] = "#00510C";
    document.getElementById("foldergrid").style["color"] = "#A6A6A6";
  };
</script>


<script>
$(function($){
    var fixedBarTemplate = '<div class="fixed-scrollbar"><div></div></div>';
    var fixedBarCSS = { display: 'none', overflowX: 'scroll', position: 'fixed',  width: '100%', bottom: 0 };

    $('.fixed-scrollbar-container').each(function() {
        var $container = $(this);
        var $bar = $(fixedBarTemplate).appendTo($container).css(fixedBarCSS);

        $bar.scroll(function() {
            $container.scrollLeft($bar.scrollLeft());
        });

        $bar.data("status", "off");
    });

    var fixSize = function() {
        $('.fixed-scrollbar').each(function() {
            var $bar = $(this);
            var $container = $bar.parent();

            $bar.children('div').height(1).width($container[0].scrollWidth);
            $bar.width($container.width()).scrollLeft($container.scrollLeft());
        });

        $(window).trigger("scroll.fixedbar");
    };

    $(window).on("load.fixedbar resize.fixedbar", function() {
        fixSize();
    });

    var scrollTimeout = null;

    $(window).on("scroll.fixedbar", function() { 
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(function() {
            $('.fixed-scrollbar-container').each(function() {
                var $container = $(this);
                var $bar = $container.children('.fixed-scrollbar');

                if($bar.length && ($container[0].scrollWidth > $container.width())) {
                    var containerOffset = {top: $container.offset().top, bottom: $container.offset().top + $container.height() };
                    var windowOffset = {top: $(window).scrollTop(), bottom: $(window).scrollTop() + $(window).height() };

                    if((containerOffset.top > windowOffset.bottom) || (windowOffset.bottom > containerOffset.bottom)) {
                        if($bar.data("status") == "on") {
                            $bar.hide().data("status", "off");
                        }
                    } else {
                        if($bar.data("status") == "off") {
                            $bar.show().data("status", "on");
                            $bar.scrollLeft($container.scrollLeft());
                        }
                    }
                } else {
                    if($bar.data("status") == "on") {
                        $bar.hide().data("status", "off");
                    }
                }
            });
        }, 50);
    });

    $(window).trigger("scroll.fixedbar");
});


</script>


<script>
  $('.select-all').click(function(event) {   
    if(this.checked) {
        $('.video-check').each(function() {
            this.checked = true;                        
        });
    } else {
        $('.video-check').each(function() {
            this.checked = false;                       
        });
    }
  });
  $('table input[type="checkbox"]').change(function(){ 
    var count = $(".video-check:checked").length;
    var checkBox = '.video-check';
    if($(checkBox).length == count){
      $('.select-all').prop('checked', true);
    }
    else if($(checkBox).length == count + 1 && $('.select-all').is(':checked')){
      $('.select-all').prop('checked', false);
    }
    else if(count < $(checkBox).length - 1){
      $('.select-all').prop('checked', false);
    }
    else{
      $('.select-all').prop('checked', true);
    }
    if ($('.select-all').is(':checked')){
      $('.select-count').text("All selected");
    }
    else{
      $('.select-count').text(count - 1 +" selected");
    }
    if(count > 0){
      $('.extra-div').css({"height":"35px", "transition":"0.2s", "visibility":"visible"});
    }
    else{
      $('.extra-div').css({"height":"0", "transition":"0.2s", "visibility":"hidden"});
    }
  });

</script>

<script>
function confirmDelete(id2, title, datetime, thumbnail, views, row) {
  $('.modal-thumbnail').attr("src", thumbnail);
  $('.modal-video-title').text(title);
  $('.modal-datetime').text(datetime);
  $('.modal-views').text(views+" views");
  $('.id2').text(id2);
  $('.row-number').text(row);
}
</script>

<script>
function editFolder(id, thumbnail, name, video) {
  $('.folder-modal-thumbnail').attr("src", thumbnail);
  $('.modal-folder-title').text(name);
  $('.modal-folder-videos').text("Total video: "+video);
  $('#take-folder-title').val(name);
}
</script>

<script>
  $('#delete-checkbox').click(function(event) {   
    if(this.checked) {
      document.getElementById('delete-btn').removeAttribute('disabled');
    } else {
      document.getElementById('delete-btn').disabled = true;
    }
  });
</script>

<script>
  $(".alert-bottom").hide();
  function onDeleteVideo(event){
    event.preventDefault();

    var formData = new FormData();
    formData.append("id2", $(".id2").text());
    
    console.log(formData);

    var xhr=new XMLHttpRequest();
    {% for video in video %}
    {% if forloop.counter < 2 %} 
    xhr.open("POST", "http://localhost:8000/{{video.channel.id}}/delete-video", true);
    {% endif %} 
    {% endfor %}
    xhr.addEventListener('load', (event) =>{
      $("#deleteConfirm").modal("hide");
      document.getElementById("allvideo").deleteRow(parseInt($(".row-number").text()));
      myAlertBottom();
    });
    xhr.send(formData);
  }
  function myAlertBottom(){
    $(".alert-bottom").show();
    setTimeout(function(){
      $(".alert-bottom").hide(); 
    }, 5000);
  }
</script>


<script>
function myFunction() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("allvideo");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[2];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}
</script>





<script>
  var box = paginator({
    table: document.getElementById("allvideo").getElementsByTagName("table")[0],
    box_mode: "list",
});
box.className = "box";
document.getElementById("video-table").appendChild(box);


/*****************************************************
 * Paginator Function                                *
 *****************************************************
 * config : {
 *     get_rows : function used to select rows to do pagination on
 *         If no function is provided, checks for a config.table element and looks for rows in there to page
 *
 *     box : Empty element that will have page buttons added to it
 *         If no config.box is provided, but a config.table is, then the page buttons will be added using the table
 *
 *     table : table element to be paginated
 *         not required if a get_rows function is provided
 *
 *     rows_per_page : number of rows to display per page
 *         default number is 10
 *
 *     page: page to display
 *         default page is 1
 *
 *     box_mode: "list", "buttons", or function. determines how the page number buttons are built.
 *         "list" builds the page index in list format and adds class "pagination" to the ul element. Meant for use with bootstrap
 *         "buttons" builds the page index out of buttons
 *         if this field is a function, it will be passed the config object as its ownly param and assumed to build the page index buttons
 *
 *     page_options: false or [{text: , value: }, ... ] used to set what the dropdown menu options are available, resets rows_per_page value
 *         false prevents the options from being displayed
 *         [{text: , value: }, ... ] allows you to customize what values can be chosen, a value of 0 will display all the table's rows.
 *         the default setup is
 *           [
 *               { value: 5,  text: '5'   },
 *               { value: 10, text: '10'  },
 *               { value: 20, text: '20'  },
 *               { value: 50, text: '50'  },
 *               { value: 100,text: '100' },
 *               { value: 0,  text: 'All' }
 *           ]
 *
 *      active_class: set the class for page buttons to have when active.
 *          defaults to "active"
 *
 *     tail_call: function to be called after paginator is done
 * }
 */
function paginator(config) {
    // throw errors if insufficient parameters were given
    if (typeof config != "object")
        throw "Paginator was expecting a config object!";
    if (typeof config.get_rows != "function" && !(config.table instanceof Element))
        throw "Paginator was expecting a table or get_row function!";

    // get/make an element for storing the page numbers in
    var box;
    if (!(config.box instanceof Element)) {
        config.box = document.createElement("div");
    }
    box = config.box;

    // get/make function for getting table's rows
    if (typeof config.get_rows != "function") {
        config.get_rows = function () {
            var table = config.table
            var tbody = table.getElementsByTagName("tbody")[0]||table;

            // get all the possible rows for paging
            // exclude any rows that are just headers or empty
            children = tbody.children;
            var trs = [];
            for (var i=0;i<children.length;i++) {
                if (children[i].nodeType = "tr") {
                    if (children[i].getElementsByTagName("td").length > 0) {
                        trs.push(children[i]);
                    }
                }
            }

            return trs;
        }
    }
    var get_rows = config.get_rows;
    var trs = get_rows();

    // get/set rows per page
    if (typeof config.rows_per_page == "undefined") {
        var selects = box.getElementsByTagName("select");
        if (typeof selects != "undefined" && (selects.length > 0 && typeof selects[0].selectedIndex != "undefined")) {
            config.rows_per_page = selects[0].options[selects[0].selectedIndex].value;
        } else {
            config.rows_per_page = 10;
        }
    }
    var rows_per_page = config.rows_per_page;

    // get/set current page
    if (typeof config.page == "undefined") {
        config.page = 1;
    }
    var page = config.page;

    // get page count
    var pages = (rows_per_page > 0)? Math.ceil(trs.length / rows_per_page):1;

    // check that page and page count are sensible values
    if (pages < 1) {
        pages = 1;
    }
    if (page > pages) {
        page = pages;
    }
    if (page < 1) {
        page = 1;
    }
    config.page = page;
 
    // hide rows not on current page and show the rows that are
    for (var i=0;i<trs.length;i++) {
        if (typeof trs[i]["data-display"] == "undefined") {
            trs[i]["data-display"] = trs[i].style.display||"";
        }
        if (rows_per_page > 0) {
            if (i < page*rows_per_page && i >= (page-1)*rows_per_page) {
                trs[i].style.display = trs[i]["data-display"];
            } else {
                trs[i].style.display = "none";
            }
        } else {
            trs[i].style.display = trs[i]["data-display"];
        }
    }

    // page button maker functions
    config.active_class = config.active_class||"active";
    if (typeof config.box_mode != "function" && config.box_mode != "list" && config.box_mode != "buttons") {
        config.box_mode = "button";
    }
    if (typeof config.box_mode == "function") {
        config.box_mode(config);
    } else {
        var make_button;
        if (config.box_mode == "list") {
            make_button = function (symbol, index, config, disabled, active) {
                var li = document.createElement("li");
                var a  = document.createElement("a");
                a.href = "#";
                a.innerHTML = symbol;
                a.addEventListener("click", function (event) {
                    event.preventDefault();
                    this.parentNode.click();
                    return false;
                }, false);
                li.appendChild(a);

                var classes = [];
                if (disabled) {
                    classes.push("disabled");
                }
                if (active) {
                    classes.push(config.active_class);
                }
                li.className = classes.join(" ");
                li.addEventListener("click", function () {
                    if (this.className.split(" ").indexOf("disabled") == -1) {
                        config.page = index;
                        paginator(config);
                    }
                }, false);
                return li;
            }
        } else {
            make_button = function (symbol, index, config, disabled, active) {
                var button = document.createElement("button");
                button.innerHTML = symbol;
                button.addEventListener("click", function (event) {
                    event.preventDefault();
                    if (this.disabled != true) {
                        config.page = index;
                        paginator(config);
                    }
                    return false;
                }, false);
                if (disabled) {
                    button.disabled = true;
                }
                if (active) {
                    button.className = config.active_class;
                }
                return button;
            }
        }

        // make page button collection
        var page_box = document.createElement(config.box_mode == "list"?"ul":"div");
        if (config.box_mode == "list") {
            page_box.className = "pagination";
        }

        var left = make_button("&laquo;", (page>1?page-1:1), config, (page == 1), false);
        page_box.appendChild(left);

        for (var i=1;i<=pages;i++) {
            var li = make_button(i, i, config, false, (page == i));
            page_box.appendChild(li);
        }

        var right = make_button("&raquo;", (pages>page?page+1:page), config, (page == pages), false);
        page_box.appendChild(right);
        if (box.childNodes.length) {
            while (box.childNodes.length > 1) {
                box.removeChild(box.childNodes[0]);
            }
            box.replaceChild(page_box, box.childNodes[0]);
        } else {
            box.appendChild(page_box);
        }
    }
  
  var dvRecords = document.createElement("div");
  dvRecords.className = "dvrecords";
  box.appendChild(dvRecords);

    // make rows per page selector
    if (!(typeof config.page_options == "boolean" && !config.page_options)) {
        if (typeof config.page_options == "undefined") {
            config.page_options = [
                { value: 5,  text: '5'   },
                { value: 10, text: '10'  },
                { value: 20, text: '20'  },
                { value: 50, text: '50'  },
                { value: 100,text: '100' },
                { value: 0,  text: 'All' }
            ];
        }
        var options = config.page_options;
        var select = document.createElement("select");
        select.className = "records";
        for (var i=0;i<options.length;i++) {
            var o = document.createElement("option");
            o.value = options[i].value;
            o.text = options[i].text;
            select.appendChild(o);
        }
        select.value = rows_per_page;
        select.addEventListener("change", function () {
            config.rows_per_page = this.value;
            paginator(config);
        }, false);
        dvRecords.appendChild(select);
    }

    // status message
    var stat = document.createElement("span");
    stat.className = "stats";
    stat.innerHTML = "On page " + page + " of " + pages
        + ", showing rows " + (((page-1)*rows_per_page)+1)
        + " to " + (trs.length<page*rows_per_page||rows_per_page==0?trs.length:page*rows_per_page)
        + " of " + trs.length;
    
    dvRecords.appendChild(stat);

    // run tail function
    if (typeof config.tail_call == "function") {
        config.tail_call(config);
    }
    return box;
}


/**
 * jQuery.fn.sortElements
 * --------------
 * @author James Padolsey (http://james.padolsey.com)
 * @version 0.11
 * @updated 18-MAR-2010
 * --------------
 * @param Function comparator:
 *   Exactly the same behaviour as [1,2,3].sort(comparator)
 *   
 * @param Function getSortable
 *   A function that should return the element that is
 *   to be sorted. The comparator will run on the
 *   current collection, but you may want the actual
 *   resulting sort to occur on a parent or another
 *   associated element.
 *   
 *   E.g. $('td').sortElements(comparator, function(){
 *      return this.parentNode; 
 *   })
 *   
 *   The <td>'s parent (<tr>) will be sorted instead
 *   of the <td> itself.
 */
jQuery.fn.sortElements = (function(){
    
    var sort = [].sort;
    
    return function(comparator, getSortable) {
        
        getSortable = getSortable || function(){return this;};
        
        var placements = this.map(function(){
            
            var sortElement = getSortable.call(this),
                parentNode = sortElement.parentNode,
                
                // Since the element itself will change position, we have
                // to have some way of storing it's original position in
                // the DOM. The easiest way is to have a 'flag' node:
                nextSibling = parentNode.insertBefore(
                    document.createTextNode(''),
                    sortElement.nextSibling
                );
            
            return function() {
                
                if (parentNode === this) {
                    throw new Error(
                        "You can't sort elements if any one is a descendant of another."
                    );
                }
                
                // Insert before flag:
                parentNode.insertBefore(this, nextSibling);
                // Remove flag:
                parentNode.removeChild(nextSibling);
                
            };
            
        });
       
        return sort.call(this, comparator).each(function(i){
            placements[i].call(getSortable.call(this));
        });
        
    };
    
})();

    var table = $('table');
    
    $('th')
        .wrapInner('<span title="sort this column"/>')
        .each(function(){
            
            var th = $(this),
                thIndex = th.index(),
                inverse = false;
            
            th.click(function(){
                
                table.find('td').filter(function(){
                    
                    return $(this).index() === thIndex;
                    
                }).sortElements(function(a, b){
                    
                    return $.text([a]) > $.text([b]) ?
                        inverse ? -1 : 1
                        : inverse ? 1 : -1;
                    
                }, function(){
                    
                    // parentNode is the element we want to move
                    return this.parentNode; 
                    
                });
                
                inverse = !inverse;
                    
            });
                
        });
</script>

{% endblock %}
